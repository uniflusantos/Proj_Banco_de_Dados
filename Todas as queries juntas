--Query: Mostre todo o histórico escolar de um aluno que teve reprovação em uma disciplina, retornando inclusive a reprovação em um semestre e a aprovação no semestre seguinte;
SELECT *
FROM "Historico_Aluno"
WHERE "RA" = 'A3231';

--Query: Mostre todos os TCCs orientados por um professor junto com os nomes dos alunos que fizeram o projeto;
SELECT
    t."TCC_ID",
    t."Titulo",
    a."Nome" AS aluno_nome
FROM "TCC" t
JOIN "TCC_Aluno" ta ON t."TCC_ID" = ta."TCC_ID"
JOIN "Aluno" a ON ta."RA" = a."RA"
WHERE t."Orientador" = 'PD3491';

--Query: Mostre a matriz curicular de pelo menos 2 cursos diferentes que possuem disciplinas em comum (e.g., Ciência da Computação e Ciência de Dados). Este exercício deve ser dividido em 2 queries sendo uma para cada curso;
SELECT
    m."Semestre",
    d."Disc_ID",
    d."Nome" AS "Disciplina"
FROM "Matriz_Curricular" m
JOIN "Disciplina" d ON m."Disc_ID" = d."Disc_ID"
JOIN "Curso" c ON m."Curso_ID" = c."Curso_ID"
WHERE c."Curso_ID" = 'C07'
ORDER BY m."Semestre"


SELECT
    m."Semestre",
    d."Disc_ID",
    d."Nome" AS "Disciplina"
FROM "Matriz_Curricular" m
JOIN "Disciplina" d ON m."Disc_ID" = d."Disc_ID"
JOIN "Curso" c ON m."Curso_ID" = c."Curso_ID"
WHERE c."Curso_ID" = 'C98'
ORDER BY m."Semestre"

--Query: Para um determinado aluno, mostre os códigos e nomes das diciplinas já cursadas junto com os nomes dos professores que lecionaram a disciplina para o aluno;
SELECT 
    ha."Disc_ID",
    ha."Disc_Nome",
    p."Nome" AS professor_nome,
    p."Prof_ID" AS professor_id
FROM "Historico_Aluno" ha
JOIN "Historico_Professor" hp 
    ON ha."Disc_ID" = hp."Disc_ID"
JOIN "Professor" p 
    ON hp."Prof_ID" = p."Prof_ID"
WHERE ha."RA" = 'A3811'
ORDER BY ha."Ano", ha."Semestre", ha."Disc_ID"

--Query: Liste todos os chefes de departamento e coordenadores de curso em apenas uma query de forma que a primeira coluna seja o nome do professor, a segunda o nome do departamento coordena e a terceira o nome do curso que coordena. Substitua os campos em branco do resultado da query pelo texto "nenhum"
SELECT 
    p."Nome" AS professor_nome,
    COALESCE(dep."Nome", 'nenhum') AS departamento_chefe,
    COALESCE(cur."Nome", 'nenhum') AS curso_coordenador
FROM "Professor" p
LEFT JOIN "Departamento" dep ON p."Prof_ID" = dep."Chefe"
LEFT JOIN "Curso" cur ON p."Prof_ID" = cur."Coordenador"
WHERE dep."Chefe" IS NOT NULL OR cur."Coordenador" IS NOT NULL;

-- Query: Encontre os nomes de todos os estudantes
SELECT 
    "RA",
    "Nome"
FROM "Aluno"
ORDER BY "Nome";

-- Query: Liste os IDs e nomes de todos os professores
SELECT 
    "Prof_ID",
    "Nome"
FROM "Professor"
ORDER BY "Nome";

-- Query: Recupere os IDs dos estudantes que não estão matriculados em nenhum curso do departamento de "Ciência da Computação"
SELECT DISTINCT a."RA", a."Nome"
FROM "Aluno" a
WHERE a."Curso" NOT IN (
    SELECT c."Curso_ID"
    FROM "Curso" c
    JOIN "Matriz_Curricular" mc ON c."Curso_ID" = mc."Curso_ID"
    JOIN "Disciplina" d ON mc."Disc_ID" = d."Disc_ID"
    WHERE d."Departamento" = 'DC07'
)
ORDER BY a."RA";

-- Query: Encontre os nomes de todos os estudantes que cursaram "Ciência de Dados" (curso_id = 'C98')
SELECT DISTINCT 
    a."RA",
    a."Nome"
FROM "Aluno" a
WHERE a."Curso" = 'C98'
ORDER BY a."Nome";

-- Query: Liste os IDs dos professores que ensinam mais de um curso
SELECT 
    hp."Prof_ID",
    p."Nome",
    COUNT(DISTINCT mc."Curso_ID") as num_cursos
FROM "Historico_Professor" hp
JOIN "Disciplina" d ON hp."Disc_ID" = d."Disc_ID"
JOIN "Matriz_Curricular" mc ON d."Disc_ID" = mc."Disc_ID"
JOIN "Professor" p ON hp."Prof_ID" = p."Prof_ID"
GROUP BY hp."Prof_ID", p."Nome"
HAVING COUNT(DISTINCT mc."Curso_ID") > 1
ORDER BY num_cursos DESC, p."Nome";

-- Query: Liste os cursos que foram ministrados pelos professores 'PD4539' e 'PC2188'
SELECT DISTINCT 
    c."Curso_ID",
    c."Nome" AS nome_curso,
    d."Disc_ID",
    d."Nome" AS nome_disciplina,
    p."Nome" AS nome_professor,
    hp."Semestre",
    hp."Ano"
FROM "Historico_Professor" hp
JOIN "Professor" p ON hp."Prof_ID" = p."Prof_ID"
JOIN "Disciplina" d ON hp."Disc_ID" = d."Disc_ID"
JOIN "Matriz_Curricular" mc ON d."Disc_ID" = mc."Disc_ID"
JOIN "Curso" c ON mc."Curso_ID" = c."Curso_ID"
WHERE hp."Prof_ID" IN ('PD4539', 'PC2188')
ORDER BY c."Nome", d."Nome", p."Nome", hp."Ano", hp."Semestre";

-- Query: Encontre os estudantes que cursaram "Sistemas Digitais" ou "Conectividade e IOT"
SELECT DISTINCT 
    a."RA",
    a."Nome" as nome_aluno,
    ha."Disc_Nome" as nome_disciplina
FROM "Aluno" a
JOIN "Historico_Aluno" ha ON a."RA" = ha."RA"
WHERE ha."Disc_Nome" IN ('Sistemas Digitais', 'Conectividade e IOT')
ORDER BY a."Nome", ha."Disc_Nome";

-- Query: Liste os cursos que são ministrados pelo professor 'PC8326', juntamente com os títulos dos cursos
SELECT DISTINCT 
    c."Curso_ID",
    c."Nome" AS nome_curso,
    d."Disc_ID",
    d."Nome" AS nome_disciplina,
    hp."Semestre",
    hp."Ano"
FROM "Historico_Professor" hp
JOIN "Disciplina" d ON hp."Disc_ID" = d."Disc_ID"
JOIN "Matriz_Curricular" mc ON d."Disc_ID" = mc."Disc_ID"
JOIN "Curso" c ON mc."Curso_ID" = c."Curso_ID"
WHERE hp."Prof_ID" = 'PC8326'
ORDER BY c."Nome", hp."Ano", hp."Semestre", d."Nome";

-- Query: Recupere os nomes de todos os estudantes que cursaram "Fundamentos de Algoritmos" (course_id = 'CC8882') no segundo semestre de 2024
SELECT DISTINCT
    a."RA",
    a."Nome" as nome_aluno,
    ha."Semestre",
    ha."Ano"
FROM "Aluno" a
JOIN "Historico_Aluno" ha ON a."RA" = ha."RA"
WHERE ha."Disc_ID" = 'CC8882'
    AND ha."Semestre" = 'Segundo'
    AND ha."Ano" = '2024'
ORDER BY a."Nome";

-- Query: Liste os cursos que foram ministrados por mais de um professor em semestres diferentes
WITH DisciplinaProfessores AS (
    SELECT 
        d."Disc_ID",
        d."Nome" AS nome_disciplina,
        COUNT(DISTINCT hp."Prof_ID") as num_professores,
        COUNT(DISTINCT (hp."Semestre", hp."Ano")) as num_semestres
    FROM "Disciplina" d
    JOIN "Historico_Professor" hp ON d."Disc_ID" = hp."Disc_ID"
    GROUP BY d."Disc_ID", d."Nome"
    HAVING COUNT(DISTINCT hp."Prof_ID") > 1
        AND COUNT(DISTINCT (hp."Semestre", hp."Ano")) > 1
)
SELECT 
    dp."Disc_ID",
    dp."nome_disciplina",
    p."Nome" AS nome_professor,
    hp."Semestre",
    hp."Ano"
FROM DisciplinaProfessores dp
JOIN "Historico_Professor" hp ON dp."Disc_ID" = hp."Disc_ID"
JOIN "Professor" p ON hp."Prof_ID" = p."Prof_ID"
ORDER BY dp."nome_disciplina", hp."Ano", hp."Semestre", p."Nome";
